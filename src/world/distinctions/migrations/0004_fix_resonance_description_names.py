# Generated by Django 5.2.4 on 2026-02-05 20:09
"""
Fix deprecated resonance names in distinction effect descriptions.

The target FK correctly points to new Latin-style resonance names, but the
description field (user-facing text) was using old English-style names.

Updates:
- "Serenity" -> "Sereni" (Patient)
- "Ferocity" -> "Saevus" (Wrathful)
- "Proud" -> "Dominari" (Hubris)
- "Predatory" -> "Praedari" (Rapacious, Voracious)
- "Audacity" -> "Audax" (Ambitious)
"""

from django.db import migrations


def fix_resonance_descriptions(apps, schema_editor):
    """Update effect descriptions to use current resonance names."""
    DistinctionEffect = apps.get_model("distinctions", "DistinctionEffect")

    # Map of old description patterns to new descriptions
    # Format: (distinction_slug, old_description_contains) -> new_description
    updates = [
        ("patient", "Serenity", "+10 Sereni resonance."),
        ("wrathful", "Ferocity", "+10 Saevus resonance."),
        ("hubris", "Proud", "+15 Dominari resonance."),
        ("rapacious", "Predatory", "+5 Praedari resonance per rank."),
        ("voracious", "Predatory", "+5 Praedari resonance per rank."),
        ("ambitious", "Audacity", "+5 Audax resonance."),
    ]

    for distinction_slug, old_pattern, new_description in updates:
        updated = DistinctionEffect.objects.filter(
            distinction__slug=distinction_slug,
            description__icontains=old_pattern,
        ).update(description=new_description)
        if updated:
            print(f"  Updated {distinction_slug}: {old_pattern} -> {new_description}")


def reverse_resonance_descriptions(apps, schema_editor):
    """Reverse the description updates (restore old names)."""
    DistinctionEffect = apps.get_model("distinctions", "DistinctionEffect")

    # Reverse mapping
    updates = [
        ("patient", "Sereni", "+10 Serenity resonance."),
        ("wrathful", "Saevus", "+10 Ferocity resonance."),
        ("hubris", "Dominari", "+15 Proud resonance."),
        ("rapacious", "Praedari", "+5 Predatory resonance per rank."),
        ("voracious", "Praedari", "+5 Predatory resonance per rank."),
        ("ambitious", "Audax", "+5 Audacity resonance."),
    ]

    for distinction_slug, current_pattern, old_description in updates:
        DistinctionEffect.objects.filter(
            distinction__slug=distinction_slug,
            description__icontains=current_pattern,
        ).update(description=old_description)


class Migration(migrations.Migration):
    dependencies = [
        ("distinctions", "0003_remove_duplicate_effects"),
    ]

    operations = [
        migrations.RunPython(
            fix_resonance_descriptions,
            reverse_resonance_descriptions,
        ),
    ]
