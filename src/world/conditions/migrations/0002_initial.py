# Generated by Django 5.2.4 on 2026-02-06 22:04

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):
    initial = True

    dependencies = [
        ("conditions", "0001_initial"),
        ("magic", "0001_initial"),
        ("mechanics", "0003_add_resonance_fields"),
        ("objects", "0013_defaultobject_alter_objectdb_id_defaultcharacter_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="conditioninstance",
            name="source_technique",
            field=models.ForeignKey(
                blank=True,
                help_text="Technique used to apply this condition",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="conditions_caused",
                to="magic.technique",
            ),
        ),
        migrations.AddField(
            model_name="conditioninstance",
            name="target",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="condition_instances",
                to="objects.objectdb",
            ),
        ),
        migrations.AddField(
            model_name="conditionstage",
            name="resist_check_type",
            field=models.ForeignKey(
                blank=True,
                help_text="Check type to resist progression",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                to="conditions.checktype",
            ),
        ),
        migrations.AddField(
            model_name="conditionresistancemodifier",
            name="stage",
            field=models.ForeignKey(
                blank=True,
                help_text="Set for stage-specific effects",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="%(class)s_set",
                to="conditions.conditionstage",
            ),
        ),
        migrations.AddField(
            model_name="conditioninstance",
            name="current_stage",
            field=models.ForeignKey(
                blank=True,
                help_text="Current stage for progressive conditions",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                to="conditions.conditionstage",
            ),
        ),
        migrations.AddField(
            model_name="conditiondamageovertime",
            name="stage",
            field=models.ForeignKey(
                blank=True,
                help_text="Set for stage-specific effects",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="%(class)s_set",
                to="conditions.conditionstage",
            ),
        ),
        migrations.AddField(
            model_name="conditioncheckmodifier",
            name="stage",
            field=models.ForeignKey(
                blank=True,
                help_text="Set for stage-specific effects",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="%(class)s_set",
                to="conditions.conditionstage",
            ),
        ),
        migrations.AddField(
            model_name="conditioncapabilityeffect",
            name="stage",
            field=models.ForeignKey(
                blank=True,
                help_text="Set for stage-specific effects",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="%(class)s_set",
                to="conditions.conditionstage",
            ),
        ),
        migrations.AddField(
            model_name="conditiontemplate",
            name="category",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.PROTECT,
                related_name="conditions",
                to="conditions.conditioncategory",
            ),
        ),
        migrations.AddField(
            model_name="conditiontemplate",
            name="cure_check_type",
            field=models.ForeignKey(
                blank=True,
                help_text="Check type used to cure this condition, if any",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="cures_conditions",
                to="conditions.checktype",
            ),
        ),
        migrations.AddField(
            model_name="conditionstage",
            name="condition",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="stages",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditionresistancemodifier",
            name="condition",
            field=models.ForeignKey(
                blank=True,
                help_text="Set for condition-level effects (all stages)",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="%(class)s_set",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditioninstance",
            name="condition",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditiondamageovertime",
            name="condition",
            field=models.ForeignKey(
                blank=True,
                help_text="Set for condition-level effects (all stages)",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="%(class)s_set",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditiondamageinteraction",
            name="applies_condition",
            field=models.ForeignKey(
                blank=True,
                help_text="Condition to apply as a result of this interaction",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="applied_by_damage_interaction",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditiondamageinteraction",
            name="condition",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="damage_interactions",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditionconditioninteraction",
            name="condition",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="interactions_as_primary",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditionconditioninteraction",
            name="other_condition",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="interactions_as_secondary",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditionconditioninteraction",
            name="result_condition",
            field=models.ForeignKey(
                blank=True,
                help_text="Resulting condition for transform/merge outcomes",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="created_by_interaction",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditioncheckmodifier",
            name="condition",
            field=models.ForeignKey(
                blank=True,
                help_text="Set for condition-level effects (all stages)",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="%(class)s_set",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="conditioncapabilityeffect",
            name="condition",
            field=models.ForeignKey(
                blank=True,
                help_text="Set for condition-level effects (all stages)",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="%(class)s_set",
                to="conditions.conditiontemplate",
            ),
        ),
        migrations.AddField(
            model_name="damagetype",
            name="resonance",
            field=models.OneToOneField(
                blank=True,
                help_text="Associated magical resonance (category='resonance'), if any",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="damage_type",
                to="mechanics.modifiertype",
            ),
        ),
        migrations.AddField(
            model_name="conditionresistancemodifier",
            name="damage_type",
            field=models.ForeignKey(
                blank=True,
                help_text="Specific damage type, or null for ALL damage types",
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                to="conditions.damagetype",
            ),
        ),
        migrations.AddField(
            model_name="conditiondamageovertime",
            name="damage_type",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to="conditions.damagetype"
            ),
        ),
        migrations.AddField(
            model_name="conditiondamageinteraction",
            name="damage_type",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to="conditions.damagetype"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="conditionstage",
            unique_together={("condition", "stage_order")},
        ),
        migrations.AddIndex(
            model_name="conditioninstance",
            index=models.Index(fields=["expires_at"], name="conditions__expires_a14801_idx"),
        ),
        migrations.AddConstraint(
            model_name="conditioninstance",
            constraint=models.UniqueConstraint(
                fields=("target", "condition"), name="unique_condition_per_target"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="conditionconditioninteraction",
            unique_together={("condition", "other_condition", "trigger")},
        ),
        migrations.AddConstraint(
            model_name="conditioncheckmodifier",
            constraint=models.CheckConstraint(
                condition=models.Q(
                    models.Q(("condition__isnull", False), ("stage__isnull", True)),
                    models.Q(("condition__isnull", True), ("stage__isnull", False)),
                    _connector="OR",
                ),
                name="conditions_conditioncheckmodifier_exactly_one_target",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditioncheckmodifier",
            constraint=models.UniqueConstraint(
                condition=models.Q(("condition__isnull", False)),
                fields=("condition", "check_type"),
                name="check_modifier_unique_condition",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditioncheckmodifier",
            constraint=models.UniqueConstraint(
                condition=models.Q(("stage__isnull", False)),
                fields=("stage", "check_type"),
                name="check_modifier_unique_stage",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditioncapabilityeffect",
            constraint=models.CheckConstraint(
                condition=models.Q(
                    models.Q(("condition__isnull", False), ("stage__isnull", True)),
                    models.Q(("condition__isnull", True), ("stage__isnull", False)),
                    _connector="OR",
                ),
                name="conditions_conditioncapabilityeffect_exactly_one_target",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditioncapabilityeffect",
            constraint=models.UniqueConstraint(
                condition=models.Q(("condition__isnull", False)),
                fields=("condition", "capability"),
                name="capability_effect_unique_condition",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditioncapabilityeffect",
            constraint=models.UniqueConstraint(
                condition=models.Q(("stage__isnull", False)),
                fields=("stage", "capability"),
                name="capability_effect_unique_stage",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditionresistancemodifier",
            constraint=models.CheckConstraint(
                condition=models.Q(
                    models.Q(("condition__isnull", False), ("stage__isnull", True)),
                    models.Q(("condition__isnull", True), ("stage__isnull", False)),
                    _connector="OR",
                ),
                name="conditions_conditionresistancemodifier_exactly_one_target",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditionresistancemodifier",
            constraint=models.UniqueConstraint(
                condition=models.Q(("condition__isnull", False)),
                fields=("condition", "damage_type"),
                name="resistance_modifier_unique_condition",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditionresistancemodifier",
            constraint=models.UniqueConstraint(
                condition=models.Q(("stage__isnull", False)),
                fields=("stage", "damage_type"),
                name="resistance_modifier_unique_stage",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditiondamageovertime",
            constraint=models.CheckConstraint(
                condition=models.Q(
                    models.Q(("condition__isnull", False), ("stage__isnull", True)),
                    models.Q(("condition__isnull", True), ("stage__isnull", False)),
                    _connector="OR",
                ),
                name="conditions_conditiondamageovertime_exactly_one_target",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditiondamageovertime",
            constraint=models.UniqueConstraint(
                condition=models.Q(("condition__isnull", False)),
                fields=("condition", "damage_type"),
                name="damage_over_time_unique_condition",
            ),
        ),
        migrations.AddConstraint(
            model_name="conditiondamageovertime",
            constraint=models.UniqueConstraint(
                condition=models.Q(("stage__isnull", False)),
                fields=("stage", "damage_type"),
                name="damage_over_time_unique_stage",
            ),
        ),
        migrations.AlterUniqueTogether(
            name="conditiondamageinteraction",
            unique_together={("condition", "damage_type")},
        ),
    ]
