# Generated by Django 5.2.4 on 2026-01-28 02:47

from django.db import migrations


def add_action_points_modifiers(apps, schema_editor):
    """Add action_points category and AP regen modifier types."""
    ModifierCategory = apps.get_model("mechanics", "ModifierCategory")
    ModifierType = apps.get_model("mechanics", "ModifierType")

    # Create the category
    category, _ = ModifierCategory.objects.get_or_create(
        name="action_points",
        defaults={
            "description": "Modifiers affecting action point economy",
            "display_order": 7,
        },
    )

    # Create the modifier types
    ModifierType.objects.get_or_create(
        category=category,
        name="ap_daily_regen",
        defaults={
            "description": "Modifier to daily action point regeneration",
            "display_order": 1,
            "is_active": True,
        },
    )
    ModifierType.objects.get_or_create(
        category=category,
        name="ap_weekly_regen",
        defaults={
            "description": "Modifier to weekly action point regeneration",
            "display_order": 2,
            "is_active": True,
        },
    )


def remove_action_points_modifiers(apps, schema_editor):
    """Remove action_points category and types."""
    ModifierCategory = apps.get_model("mechanics", "ModifierCategory")
    # CASCADE will delete the types
    ModifierCategory.objects.filter(name="action_points").delete()


class Migration(migrations.Migration):
    dependencies = [
        ("mechanics", "0003_add_modifier_source_update_schema"),
    ]

    operations = [
        migrations.RunPython(
            add_action_points_modifiers,
            remove_action_points_modifiers,
        ),
    ]
