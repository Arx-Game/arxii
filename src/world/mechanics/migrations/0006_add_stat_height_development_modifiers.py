# Generated by Django 5.2.4 on 2026-01-28

from django.db import migrations


def add_stat_height_development_modifiers(apps, schema_editor):
    """Add stat, height_band, and development modifier categories and types."""
    ModifierCategory = apps.get_model("mechanics", "ModifierCategory")
    ModifierType = apps.get_model("mechanics", "ModifierType")

    # === STAT MODIFIERS ===
    # For distinctions that modify base stats like Strength
    stat_category, _ = ModifierCategory.objects.get_or_create(
        name="stat",
        defaults={
            "description": "Modifiers to character base stats",
            "display_order": 1,
        },
    )

    # Physical stats
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="strength",
        defaults={
            "description": "Modifier to Strength stat",
            "display_order": 1,
            "is_active": True,
        },
    )
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="dexterity",
        defaults={
            "description": "Modifier to Dexterity stat",
            "display_order": 2,
            "is_active": True,
        },
    )
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="stamina",
        defaults={
            "description": "Modifier to Stamina stat",
            "display_order": 3,
            "is_active": True,
        },
    )

    # Social stats
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="charm",
        defaults={
            "description": "Modifier to Charm stat",
            "display_order": 4,
            "is_active": True,
        },
    )
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="command",
        defaults={
            "description": "Modifier to Command stat",
            "display_order": 5,
            "is_active": True,
        },
    )
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="composure",
        defaults={
            "description": "Modifier to Composure stat",
            "display_order": 6,
            "is_active": True,
        },
    )

    # Mental stats
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="intellect",
        defaults={
            "description": "Modifier to Intellect stat",
            "display_order": 7,
            "is_active": True,
        },
    )
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="perception",
        defaults={
            "description": "Modifier to Perception stat",
            "display_order": 8,
            "is_active": True,
        },
    )
    ModifierType.objects.get_or_create(
        category=stat_category,
        name="wits",
        defaults={
            "description": "Modifier to Wits stat",
            "display_order": 9,
            "is_active": True,
        },
    )

    # === HEIGHT BAND MODIFIERS ===
    # For distinctions that affect maximum selectable height band
    height_category, _ = ModifierCategory.objects.get_or_create(
        name="height_band",
        defaults={
            "description": "Modifiers affecting character height options",
            "display_order": 8,
        },
    )

    ModifierType.objects.get_or_create(
        category=height_category,
        name="max_height_band_bonus",
        defaults={
            "description": "Additional height bands above normal maximum",
            "display_order": 1,
            "is_active": True,
        },
    )

    # === DEVELOPMENT RATE MODIFIERS ===
    # For distinctions that affect skill development speed
    development_category, _ = ModifierCategory.objects.get_or_create(
        name="development",
        defaults={
            "description": "Modifiers affecting skill and trait development rates",
            "display_order": 9,
        },
    )

    # Physical skills development rate (percentage modifier, -20 = 20% slower)
    ModifierType.objects.get_or_create(
        category=development_category,
        name="physical_skill_development_rate",
        defaults={
            "description": "Percentage modifier to physical skill development rate",
            "display_order": 1,
            "is_active": True,
        },
    )

    # Social skills development rate
    ModifierType.objects.get_or_create(
        category=development_category,
        name="social_skill_development_rate",
        defaults={
            "description": "Percentage modifier to social skill development rate",
            "display_order": 2,
            "is_active": True,
        },
    )

    # Mental skills development rate
    ModifierType.objects.get_or_create(
        category=development_category,
        name="mental_skill_development_rate",
        defaults={
            "description": "Percentage modifier to mental skill development rate",
            "display_order": 3,
            "is_active": True,
        },
    )

    # All skills development rate (applies to everything)
    ModifierType.objects.get_or_create(
        category=development_category,
        name="all_skill_development_rate",
        defaults={
            "description": "Percentage modifier to all skill development rates",
            "display_order": 4,
            "is_active": True,
        },
    )


def remove_stat_height_development_modifiers(apps, schema_editor):
    """Remove the stat, height_band, and development categories."""
    ModifierCategory = apps.get_model("mechanics", "ModifierCategory")
    # CASCADE will delete the types
    ModifierCategory.objects.filter(name__in=["stat", "height_band", "development"]).delete()


class Migration(migrations.Migration):
    dependencies = [
        ("mechanics", "0005_add_ap_maximum_modifier"),
    ]

    operations = [
        migrations.RunPython(
            add_stat_height_development_modifiers,
            remove_stat_height_development_modifiers,
        ),
    ]
