"""Add skeletons for very basic flows that are foundational to gameplay."""

# Generated by Django 5.2.4 on 2025-07-24 03:43

from django.db import migrations


def create_basic_flows(apps, schema_editor):
    FlowDefinition = apps.get_model("flows", "FlowDefinition")
    FlowStepDefinition = apps.get_model("flows", "FlowStepDefinition")

    look_flow, _ = FlowDefinition.objects.get_or_create(
        name="look",
        defaults={
            "description": "Send a formatted description of the target to the caller.",
        },
    )

    step1, _ = FlowStepDefinition.objects.get_or_create(
        flow=look_flow,
        parent=None,
        action="call_service_function",
        variable_name="get_formatted_description",
        defaults={
            "parameters": {"obj": "$target", "mode": "$mode", "result_variable": "desc"}
        },
    )

    FlowStepDefinition.objects.get_or_create(
        flow=look_flow,
        parent_id=step1.id,
        action="call_service_function",
        variable_name="send_message",
        defaults={"parameters": {"recipient": "$caller", "text": "$desc"}},
    )


class Migration(migrations.Migration):

    dependencies = [
        ("flows", "0001_initial"),
    ]

    operations = [
        migrations.RunPython(
            create_basic_flows, reverse_code=migrations.RunPython.noop
        ),
    ]
